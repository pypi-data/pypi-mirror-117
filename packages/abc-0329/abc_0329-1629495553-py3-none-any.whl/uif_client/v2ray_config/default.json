// 使用这个配置需要 caddy 或者 ngnix 的配合，他们接收来自用户的请求，然后解密tls，
// 最后转发到v2ray（即此处）

{
  "log": {
    "loglevel": "none" // 真实环境中不应该有log，不然会挤爆硬盘。
  },
  "inbounds": [{
    "port": 10000,
    "tag": "uif_inbound", // not free
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "protocol": "vmess",
    "settings": {
      "clients": [{
        "id": "a831381d-6324-4d53-ad4f-9cda48b30648",
        "alterId": 0
      }] // 可由用户自由添加
    },
    "streamSettings": {
      "network": "ws",
      "wsSettings": {
        "path": "/uif"
      }
    }
  }, {
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "port": 10085,
    "protocol": "dokodemo-door",
    "settings": {
      "address": "127.0.0.1"
    },
    "tag": "api"
  }, {
    "port": 10001,
    "tag": "uif_inbound_free",
    "listen": "127.0.0.1", // 仅监听本地，外网不可见。
    "protocol": "vmess",
    "settings": {
      "clients": [{
        "id": "b831381d-6324-4d53-ad4f-9cda48b30822", // 建议经常变，以防有些人长久霸占
        "alterId": 0
      }]
    },
    "streamSettings": {
      "network": "ws",
      "wsSettings": {
        "path": "/uif_free"
      }
    }
  }, {
    "protocol": "vmess",
    "tag": "moblie",
    "listen": "0.0.0.0", // 外网可见
    "port": 8080,
    "settings": {
      "clients": [{
        "id": "ad806487-2d26-4636-98b6-ab65cc8521f7",
        "alterId": 64,
        "security": "auto"
      }]
    },
    "streamSettings": {
      "network": "tcp",
      "tcpSettings": {
        "connectionReuse": true,
        "header": {
          "type": "http",
          "request": {
            "version": "1.1",
            "method": "GET",
            "path": ["/"],
            "headers": {
              "Host": ["push.m.youku.com"],
              "X-Ucbrowser-Ua": [
                "dv(iPh9,1);pr(UCBrowser/13.4.7.1520);ov(14_4_1);ss(375x667);bt(UC);pm(0);bv(0);nm(0);im(0);nt(1);"
              ],
              "X-Amzn-Trace-Id": [
                "Root=1-61103291-27910a974b4dcca36853055d"
              ],
              "X-Amzn-Trace-Id": [
                "172.16.3.189|8804|1|1626768690631380347|com.ucweb.iphone.lowversion|f11978c7d80de5b429491abd433bef0a"
              ],
              "User-Agent": [
                "Mozilla/5.0 (iPhone; CPU iPhone OS 14_4_1 like Mac OS X; zh-CN) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/18D61 UCBrowser/13.4.7.1520 Mobile  AliApp(TUnionSDK/0.1.20.4)"
              ],
              "Accept-Encoding": ["gzip, deflate"],
              "Connection": ["keep-alive"],
              "Pragma": "no-cache"
            }
          },
          "response": {
            "version": "1.1",
            "status": "200",
            "reason": "OK",
            "headers": {
              "Content-Type": ["application/octet-stream", "application/x-msdownload", "text/html", "application/x-shockwave-flash"],
              "Transfer-Encoding": ["chunked"],
              "Connection": ["keep-alive"],
              "Pragma": "no-cache"
            }
          }
        }
      }
    }
  }],
  "api": {
    "tag": "api",
    "services": [
      "HandlerService",
      "StatsService"
    ]
  },
  "policy": {
    "levels": {
      "0": {
        "statsUserUplink": true, //开启用户流量上传统计
        "statsUserDownlink": true //开启用户流量下载统计
      }
    },
    "system": {
      "statsInboundUplink": true, //开启入站方向的流量上传
      "statsInboundDownlink": true, //开启入站方向的流量下载
      "statsOutboundUplink": true, //开启出站方向的流量上传
      "statsOutboundDownlink": true //开启出站方向的流量下载
    }
  },
  "outbounds": [{
    "tag": "IP4_out",
    "protocol": "freedom"
  }, {
    "tag": "IP6_out",
    "protocol": "freedom",
    "settings": {
      "domainStrategy": "UseIPv6" // 指定使用 IPv6
    }
  }, {
    "tag": "block",
    "protocol": "blackhole",
    "settings": {
      "response": {
        "type": "http"
      }
    }
  }],
  "routing": {
    "rules": [{
        "inboundTag": [
          "uif_inbound"
        ],
        "type": "field",
        "outboundTag": "IP6_out",
        "network": "udp,tcp",
        "domain": ["geosite:netflix", "geosite:google"] // 走 IPv6
      },
      {
        "inboundTag": [
          "uif_inbound",
          "moblie"
        ],
        "type": "field",
        "outboundTag": "IP4_out",
        "network": "udp,tcp" // 其余走 IPv4
      }, {
        "inboundTag": [
          "uif_inbound_free"
        ],
        "outboundTag": "block",
        "domain": [
          "geosite:youtube"
        ],
        "type": "field"
      }, {
        "inboundTag": [
          "uif_inbound_free"
        ],
        "outboundTag": "IP4_out",
        "domain": [
          "geosite:bbc",
          "geosite:wikidot",
          "geosite:github",
          "geosite:gitbook",
          "geosite:golang",
          "geosite:google-scholar",
          "geosite:ieee",
          "geosite:python",
          "geosite:google-registry",
          "geosite:npmjs",
          "geosite:wikihow",
          "geosite:wikimedia",
          "geosite:category-wiki-cn",
          "geosite:translatewiki",
          "geosite:android",
          "geosite:facebook",
          "geosite:instagram",
          "geosite:twitter",
          "geosite:whatsapp",
          "geosite:telegram",
          "geosite:apple",
          "geosite:google"
        ],
        "type": "field"
      }, {
        "inboundTag": [
          "uif_inbound_free"
        ],
        "outboundTag": "block",
        "type": "field"
      }, {
        "inboundTag": [
          "api"
        ],
        "outboundTag": "api",
        "type": "field"
      }
    ]
  }
}
