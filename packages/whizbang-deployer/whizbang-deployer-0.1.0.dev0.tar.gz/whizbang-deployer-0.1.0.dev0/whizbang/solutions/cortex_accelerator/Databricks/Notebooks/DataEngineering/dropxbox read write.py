{"version":"NotebookV1","origId":3060609755373688,"name":"dropxbox read write","language":"python","commands":[{"version":"CommandV1","origId":3060609755373689,"guid":"39085c3d-cb9d-4d21-9b94-6ebac9887f0a","subtype":"command","commandType":"auto","position":0.125,"command":"import os\nimport pandas as pd","commandVersion":11,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624048723763,"submitTime":1624048723013,"finishTime":1624048723923,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b4cc1e94-0b2b-4596-b364-1537c0045f41"},{"version":"CommandV1","origId":3060609755373690,"guid":"1a7e42fc-eac3-41ba-a855-771ff757e804","subtype":"command","commandType":"auto","position":0.1875,"command":"!pip install openpyxl","commandVersion":12,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624048723926,"submitTime":1624048723067,"finishTime":1624048724613,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"228e5402-1771-4d77-9e9b-53ac713b90ae"},{"version":"CommandV1","origId":3060609755373691,"guid":"defd9486-15d0-4bf9-ba26-6aeffb865b4c","subtype":"command","commandType":"auto","position":0.25,"command":"%md\n### Set Widgets","commandVersion":9,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bff46b8d-1610-45d4-ab7f-c2d80e5600bb"},{"version":"CommandV1","origId":3060609755373692,"guid":"e18fad26-62ec-415e-b06c-23b51fc82382","subtype":"command","commandType":"auto","position":0.375,"command":"dbutils.widgets.text(\"filePath\", \"\")\ndbutils.widgets.text(\"fileName\", \"\")","commandVersion":16,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{"filePath":{"widgetType":"text","name":"filePath","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}},"fileName":{"widgetType":"text","name":"fileName","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624048724616,"submitTime":1624048723183,"finishTime":1624048724632,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5148d947-91db-426a-8e6d-0bdd61ea151a"},{"version":"CommandV1","origId":3060609755373693,"guid":"0f4d3c54-6974-42ff-9488-6bf5a428843f","subtype":"command","commandType":"auto","position":0.4375,"command":"%md\n### Pass Widgets to Parameters","commandVersion":9,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"10b606f0-7422-4a58-b91c-7601a40dd1b5"},{"version":"CommandV1","origId":3060609755373694,"guid":"dad50575-7230-4226-9974-8483cd71f0ae","subtype":"command","commandType":"auto","position":0.46875,"command":"pFilePath = dbutils.widgets.get(\"filePath\")\npFileName = dbutils.widgets.get(\"fileName\")\npTargetFilePath = 'dbfs:/mnt/'+pFilePath.split('/')[1]+'/'+pFilePath.split('/')[2]+'/'+pFileName\npExcelTargetFilePath = '/dbfs/mnt/'+pFilePath.split('/')[1]+'/'+pFilePath.split('/')[2]+'/'+pFileName\npTargetFileFormat = pFileName.split('.')[1]\n\nprint(\"pFilePath: \"+ pFilePath)\nprint(\"pFileName: \"+ pFileName)\nprint(\"pTargetFilePath: \"+ pTargetFilePath)\nprint(\"pExcelTargetFilePath: \"+ pExcelTargetFilePath)\nprint(\"pTargetFileFormat: \" + pTargetFileFormat)","commandVersion":151,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">pFilePath: maindl/DROPBOX/Ad Hoc\npFileName: dimMapping.xlsx\npTargetFilePath: dbfs:/mnt/DROPBOX/Ad Hoc/dimMapping.xlsx\npExcelTargetFilePath: /dbfs/mnt/DROPBOX/Ad Hoc/dimMapping.xlsx\npTargetFileFormat: xlsx\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{"filePath":"maindl/DROPBOX/Ad Hoc","fileName":"dimMapping.xlsx"},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049310300,"submitTime":1624049310243,"finishTime":1624049310326,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dc72a276-bd80-4f36-94ea-21caa670b26f"},{"version":"CommandV1","origId":3060609755373695,"guid":"3c6d187c-17a3-41e3-85d1-8cf75a21571d","subtype":"command","commandType":"auto","position":0.484375,"command":"pSchema = \"dropbox\"\nquery = f\"\"\"CREATE DATABASE IF NOT EXISTS {pSchema};\"\"\".format(pSchema = pSchema)\nspark.sql(query)","commandVersion":26,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Out[19]: DataFrame[]</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049315295,"submitTime":1624049315241,"finishTime":1624049315338,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"045dd582-b2b6-4bd1-b7c5-ca97347189ef"},{"version":"CommandV1","origId":3060609755373696,"guid":"6b3babd2-1e49-4d3d-95b9-eabd8cf579bc","subtype":"command","commandType":"auto","position":0.5,"command":"#pFilePath = \"dbfs:/mnt/DROPBOX/WarehouseDistributionMapping1.csv\"\n#pFileName = \"WarehouseDistributionMapping1.csv\"\npTargetTableName = pSchema+\".\"+pFileName.split(\".\")[0]\nprint(pTargetTableName )","commandVersion":144,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">dropbox.dimMapping\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049316201,"submitTime":1624049316146,"finishTime":1624049316221,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3cf20cab-5681-4227-9076-fa8f1fb49ced"},{"version":"CommandV1","origId":3060609755373697,"guid":"f93b3bef-a42a-4c93-8b77-92565943664c","subtype":"command","commandType":"auto","position":1.25,"command":"if pTargetFileFormat == 'csv':\n  df = spark.read.format('csv').options(header='true', inferSchema='true').load(pTargetFilePath)\nelif pTargetFileFormat == 'xlsx':\n  pdf = pd.read_excel(pExcelTargetFilePath, engine = 'openpyxl')\n  df = spark.createDataFrame(pdf)","commandVersion":113,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"ColumnID","nullable":true,"type":"long"},{"metadata":{},"name":"DimName","nullable":true,"type":"string"},{"metadata":{},"name":"FieldName","nullable":true,"type":"string"},{"metadata":{},"name":"ColumnType","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049317742,"submitTime":1624049317690,"finishTime":1624049318481,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"Read Dropbox Location File ","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4e28c625-e712-4a29-a27f-fdf873683292"},{"version":"CommandV1","origId":3060609755373698,"guid":"119232c6-531a-400b-bed8-6c73c819b726","subtype":"command","commandType":"auto","position":1.375,"command":"\ndf.write.format(\"delta\").mode('overwrite').saveAsTable(pTargetTableName)","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049319987,"submitTime":1624049319933,"finishTime":1624049330250,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"Write Read File to Delta Table","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8c207875-d9e9-4eed-aa5d-d2c5df1ad7e7"},{"version":"CommandV1","origId":3060609755373699,"guid":"84b83aa9-f862-4c03-8b64-87fa21211030","subtype":"command","commandType":"auto","position":1.5,"command":"tempDirPath = \"/dbfs/mnt/STAGE/adb_temp\"\n# if the directory does not exist, create it\nif not os.path.exists(tempDirPath):\n  os.makedirs(tempDirPath)      ","commandVersion":18,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049336860,"submitTime":1624049336773,"finishTime":1624049337069,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b936e934-4ebc-45fc-91c7-b25d1500ebc2"},{"version":"CommandV1","origId":3060609755373700,"guid":"ec010e08-71b9-4476-8d12-55c02da1011e","subtype":"command","commandType":"auto","position":1.75,"command":"pp_args = {\"deltaSchemaName\":pSchema, \"sourceObject\":pFileName.split(\".\")[0], \"targetSchema\":pSchema, \"targetObject\":pFileName.split(\".\")[0],\"Execute Query\":\"TRUE\",\"tempDirPath\":'STAGE/adb_temp', \"lastRefreshDate\":\"\", \"copyType\":\"\", \"deltaLayerType\":\"\", \"synapseColumnDefinition\":\"\", \"returnSchema\":\"TRUE\"}\npWriteDataToSynapse = '/DataEngineering/WriteDataToSynapse'","commandVersion":107,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049339782,"submitTime":1624049339729,"finishTime":1624049339802,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"Build parameters for delta to synapse notebook","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"14c86b78-b77c-4f3f-834f-df2748abf9bf"},{"version":"CommandV1","origId":3060609755373701,"guid":"ef2aec0f-460a-461e-940c-10dab1f978eb","subtype":"command","commandType":"auto","position":2.0,"command":"print(pp_args)","commandVersion":5,"state":"error","results":null,"errorSummary":"Command skipped","errorTraceType":null,"error":null,"workflows":[],"startTime":1624048723635,"submitTime":1624048723635,"finishTime":1624048725373,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c81fe61f-73bd-4b8b-8b72-5ecc06122782"},{"version":"CommandV1","origId":3060609755373702,"guid":"783df701-5e84-47cb-bf80-301964f7176c","subtype":"command","commandType":"auto","position":2.25,"command":"dbutils.notebook.run(pWriteDataToSynapse, 10800, pp_args)","commandVersion":10,"state":"error","results":null,"errorSummary":"Command skipped","errorTraceType":null,"error":null,"workflows":[],"startTime":1624048723691,"submitTime":1624048723691,"finishTime":1624048725388,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"Call WriteDataToSynapse notebook to ingest delta table","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f3a7a3a6-40e3-4555-ba03-ca99def05c18"}],"dashboards":[],"guid":"3f59a759-97ae-40f6-b775-f0cd2b3e3804","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"filePath":{"nuid":"a323256c-1233-48a5-a411-92cd0b2ad2e5","currentValue":"maindl/DROPBOX/Ad Hoc","widgetInfo":{"widgetType":"text","name":"filePath","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}}},"fileName":{"nuid":"178cc847-56d2-40dc-91f9-4543e62dcd66","currentValue":"dimMapping.xlsx","widgetInfo":{"widgetType":"text","name":"fileName","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":2}}