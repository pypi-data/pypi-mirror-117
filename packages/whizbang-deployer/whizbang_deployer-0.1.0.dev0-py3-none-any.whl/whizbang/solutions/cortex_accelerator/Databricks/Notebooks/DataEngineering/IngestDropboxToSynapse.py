{"version":"NotebookV1","origId":2447016245873190,"name":"IngestDropboxToSynapse","language":"python","commands":[{"version":"CommandV1","origId":2447016245873191,"guid":"3ceb83db-6496-42d6-a11f-37bd1c53afde","subtype":"command","commandType":"auto","position":0.125,"command":"import os\nimport pandas as pd","commandVersion":11,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624048723763,"submitTime":1624048723013,"finishTime":1624048723923,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b4cc1e94-0b2b-4596-b364-1537c0045f41"},{"version":"CommandV1","origId":2447016245873192,"guid":"7b30e326-8033-484f-914d-00d7fe1fa8c6","subtype":"command","commandType":"auto","position":0.1875,"command":"!pip install openpyxl","commandVersion":12,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624048723926,"submitTime":1624048723067,"finishTime":1624048724613,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"228e5402-1771-4d77-9e9b-53ac713b90ae"},{"version":"CommandV1","origId":2447016245873193,"guid":"1861f96d-43a3-4ac8-bb4f-03c49cb3aa40","subtype":"command","commandType":"auto","position":0.25,"command":"%md\n### Set Widgets","commandVersion":9,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"bff46b8d-1610-45d4-ab7f-c2d80e5600bb"},{"version":"CommandV1","origId":2447016245873194,"guid":"128714df-3d8b-4728-b8c6-2ef25d8dea0d","subtype":"command","commandType":"auto","position":0.375,"command":"dbutils.widgets.text(\"filePath\", \"\")\ndbutils.widgets.text(\"fileName\", \"\")","commandVersion":16,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{"filePath":{"widgetType":"text","name":"filePath","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}},"fileName":{"widgetType":"text","name":"fileName","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}}},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624048724616,"submitTime":1624048723183,"finishTime":1624048724632,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"5148d947-91db-426a-8e6d-0bdd61ea151a"},{"version":"CommandV1","origId":2447016245873195,"guid":"b6cf51ef-79f8-464c-8798-886f70e412d1","subtype":"command","commandType":"auto","position":0.4375,"command":"%md\n### Pass Widgets to Parameters","commandVersion":9,"state":"finished","results":null,"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"10b606f0-7422-4a58-b91c-7601a40dd1b5"},{"version":"CommandV1","origId":2447016245873196,"guid":"7564fef8-334d-45bc-84ba-4ba0eb5a83f9","subtype":"command","commandType":"auto","position":0.46875,"command":"pFilePath = dbutils.widgets.get(\"filePath\")\npFileName = dbutils.widgets.get(\"fileName\")\npTargetFilePath = 'dbfs:/mnt/'+pFilePath.split('/')[1]+'/'+pFilePath.split('/')[2]+'/'+pFileName\npExcelTargetFilePath = '/dbfs/mnt/'+pFilePath.split('/')[1]+'/'+pFilePath.split('/')[2]+'/'+pFileName\npTargetFileFormat = pFileName.split('.')[1]\n\nprint(\"pFilePath: \"+ pFilePath)\nprint(\"pFileName: \"+ pFileName)\nprint(\"pTargetFilePath: \"+ pTargetFilePath)\nprint(\"pExcelTargetFilePath: \"+ pExcelTargetFilePath)\nprint(\"pTargetFileFormat: \" + pTargetFileFormat)","commandVersion":151,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">pFilePath: maindl/DROPBOX/Ad Hoc\npFileName: dimMapping.xlsx\npTargetFilePath: dbfs:/mnt/DROPBOX/Ad Hoc/dimMapping.xlsx\npExcelTargetFilePath: /dbfs/mnt/DROPBOX/Ad Hoc/dimMapping.xlsx\npTargetFileFormat: xlsx\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{"filePath":"maindl/DROPBOX/Ad Hoc","fileName":"dimMapping.xlsx"},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049310300,"submitTime":1624049310243,"finishTime":1624049310326,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"dc72a276-bd80-4f36-94ea-21caa670b26f"},{"version":"CommandV1","origId":2447016245873197,"guid":"4ed8d9f8-f35d-44db-b2da-c2ff087a7b89","subtype":"command","commandType":"auto","position":0.484375,"command":"pSchema = \"dropbox\"\nquery = f\"\"\"CREATE DATABASE IF NOT EXISTS {pSchema};\"\"\".format(pSchema = pSchema)\nspark.sql(query)","commandVersion":26,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">Out[19]: DataFrame[]</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049315295,"submitTime":1624049315241,"finishTime":1624049315338,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"045dd582-b2b6-4bd1-b7c5-ca97347189ef"},{"version":"CommandV1","origId":2447016245873198,"guid":"e651859c-2fd4-4c7b-a892-b24704a9e0f2","subtype":"command","commandType":"auto","position":0.5,"command":"#pFilePath = \"dbfs:/mnt/DROPBOX/WarehouseDistributionMapping1.csv\"\n#pFileName = \"WarehouseDistributionMapping1.csv\"\npTargetTableName = pSchema+\".\"+pFileName.split(\".\")[0]\nprint(pTargetTableName )","commandVersion":144,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\">dropbox.dimMapping\n</div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049316201,"submitTime":1624049316146,"finishTime":1624049316221,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3cf20cab-5681-4227-9076-fa8f1fb49ced"},{"version":"CommandV1","origId":2447016245873199,"guid":"1f3ea285-aca0-46a8-a1f1-6dc3bb17cce3","subtype":"command","commandType":"auto","position":1.25,"command":"if pTargetFileFormat == 'csv':\n  df = spark.read.format('csv').options(header='true', inferSchema='true').load(pTargetFilePath)\nelif pTargetFileFormat == 'xlsx':\n  pdf = pd.read_excel(pExcelTargetFilePath, engine = 'openpyxl')\n  df = spark.createDataFrame(pdf)","commandVersion":113,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"df","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"ColumnID","nullable":true,"type":"long"},{"metadata":{},"name":"DimName","nullable":true,"type":"string"},{"metadata":{},"name":"FieldName","nullable":true,"type":"string"},{"metadata":{},"name":"ColumnType","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049317742,"submitTime":1624049317690,"finishTime":1624049318481,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"Read Dropbox Location File ","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"4e28c625-e712-4a29-a27f-fdf873683292"},{"version":"CommandV1","origId":2447016245873200,"guid":"d03ed05c-ffa4-4c81-b04f-3b533ff1eaf4","subtype":"command","commandType":"auto","position":1.375,"command":"\ndf.write.format(\"delta\").mode('overwrite').saveAsTable(pTargetTableName)","commandVersion":2,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049319987,"submitTime":1624049319933,"finishTime":1624049330250,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"Write Read File to Delta Table","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"8c207875-d9e9-4eed-aa5d-d2c5df1ad7e7"},{"version":"CommandV1","origId":2447016245873201,"guid":"a2648520-8a9d-4aa7-bde6-f1fa5e16b4ad","subtype":"command","commandType":"auto","position":1.5,"command":"tempDirPath = \"/dbfs/mnt/STAGE/adb_temp\"\n# if the directory does not exist, create it\nif not os.path.exists(tempDirPath):\n  os.makedirs(tempDirPath)      ","commandVersion":18,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049336860,"submitTime":1624049336773,"finishTime":1624049337069,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"b936e934-4ebc-45fc-91c7-b25d1500ebc2"},{"version":"CommandV1","origId":2447016245873202,"guid":"c252f2f5-7ac3-4875-bea9-7d4aaf5f5ba1","subtype":"command","commandType":"auto","position":1.75,"command":"pp_args = {\"deltaSchemaName\":pSchema, \"sourceObject\":pFileName.split(\".\")[0], \"targetSchema\":pSchema, \"targetObject\":pFileName.split(\".\")[0],\"Execute Query\":\"TRUE\",\"tempDirPath\":'STAGE/adb_temp', \"lastRefreshDate\":\"\", \"copyType\":\"\", \"deltaLayerType\":\"\", \"synapseColumnDefinition\":\"\", \"returnSchema\":\"TRUE\"}\npWriteDataToSynapse = '/DataEngineering/WriteDataToSynapse'","commandVersion":107,"state":"finished","results":{"type":"listResults","data":[{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}}],"arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[],"metadata":{}},"errorSummary":null,"errorTraceType":null,"error":null,"workflows":[],"startTime":1624049339782,"submitTime":1624049339729,"finishTime":1624049339802,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"Build parameters for delta to synapse notebook","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"14c86b78-b77c-4f3f-834f-df2748abf9bf"},{"version":"CommandV1","origId":2447016245873203,"guid":"fbbcc3af-6dea-4350-a848-95653df62eb9","subtype":"command","commandType":"auto","position":2.0,"command":"print(pp_args)","commandVersion":5,"state":"error","results":null,"errorSummary":"Command skipped","errorTraceType":null,"error":null,"workflows":[],"startTime":1624048723635,"submitTime":1624048723635,"finishTime":1624048725373,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c81fe61f-73bd-4b8b-8b72-5ecc06122782"},{"version":"CommandV1","origId":2447016245873204,"guid":"6c71ea64-943b-4100-8534-05c8bc123c5c","subtype":"command","commandType":"auto","position":2.25,"command":"dbutils.notebook.run(pWriteDataToSynapse, 10800, pp_args)","commandVersion":10,"state":"error","results":null,"errorSummary":"Command skipped","errorTraceType":null,"error":null,"workflows":[],"startTime":1624048723691,"submitTime":1624048723691,"finishTime":1624048725388,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"useConsistentColors":false,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"a user","latestUserId":null,"commandTitle":"Call WriteDataToSynapse notebook to ingest delta table","showCommandTitle":true,"hideCommandCode":false,"hideCommandResult":false,"isLockedInExamMode":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"f3a7a3a6-40e3-4555-ba03-ca99def05c18"}],"dashboards":[],"guid":"0bb139b2-5876-49ab-bb2b-a66e2ecba315","globalVars":{},"iPythonMetadata":null,"inputWidgets":{"filePath":{"nuid":"a323256c-1233-48a5-a411-92cd0b2ad2e5","currentValue":"maindl/DROPBOX/Ad Hoc","widgetInfo":{"widgetType":"text","name":"filePath","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}}},"fileName":{"nuid":"178cc847-56d2-40dc-91f9-4543e62dcd66","currentValue":"dimMapping.xlsx","widgetInfo":{"widgetType":"text","name":"fileName","defaultValue":"","label":null,"options":{"widgetType":"text","validationRegex":null}}}},"notebookMetadata":{"pythonIndentUnit":2}}